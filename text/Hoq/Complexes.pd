Произведение высших типов
--------------------------


Легко видеть, что с помощью интервала и типов данных с условиями
можно определить любой высший индуктивный тип.
Но теперь, когда о путях можно думать как об отображениях из интервала,
а о высших путях, соответственно, как об отображениях из кубов (произведений
интервала с самим собой несколько раз),
типы, содержащие высшие пути, описываются более естественным образом.

К примеру, $2$-сферу можно определить как тип, состоящий из выделенной точки
и квадрата — произведения `I` на `I` — с дополнительным условием, утверждающим, что
любая точка на границе квадрата совпадает с выделенной, как в \inlref{листинге}{lst:S2}.

~~~~{label=lst:S2 float=ht caption="Определение $2$-сферы"}
data S2 = base | loop2 I I
  with
    loop left  j = base
    loop right j = base
    loop i left  = base
    loop i right = base
~~~~

Аналогично можно определить тип, являющийся аналогом любого
CW-комплекса, используя кубы в качестве дисков и накладывая
условия, соответствующие склеивающим отображениям.

По сравнению со стандартной гомотопической теорией типов,
мы получаем возможность работать с клетками в комплексе
более удобным образом: у нас теперь есть не только
элиминатор типа путей, но и возможность осуществлять
паттерн-матчинг по дискам, извлекая «координаты» данной точки
на диске.

Тот факт, что диски представляются кубами, а произведение
$n$-куба и $m$-куба есть $(n+m)$-куб, позволяет легко
доказывать утверждения про эквивалентность CW-комплекса
произведению двух других. Кроме того, полезным оказывается
следующее утверждение из классической топологии
(доказательство которого можно найти в приложении «А»
книги Хэтчера по алгебраической топологии[@hatcher]):
если даны два CW-комплекса, и для любого $i$
первый содержит ровно $a_i$ клеток размерности $i$,
а второй — $b_i$ клеток размерности $i$,
то их произведение состоит из $a_i a_j$ клеток размерности $i+j$
для всех $i$ и $j$.

Покажем, как доказать, что тор гомотопически эквивалентен
произведению двух окружностей. В стандартной гомотопической теории
типов не известно короткого доказательства этого простого утверждения,
но в теории типов с интервалом и условиями предъявить искомую эквивалентность
очень легко. Действительно, тор, как CW-комплекс, состоит из одной 0-мерной ячейки,
двух одномерных ячеек и одной двумерной ячейки,
в качестве которой мы используем квадрат (\inlref{листинг}{lst:torus}), а
окружность — из одной 0-мерной ячейки и одной одномерной (\inlref{листинг}{lst:s1s1}).
Пару из точек на окружности,
имеющих координаты $x$ и $y$ соответственно, можно отобразить в точку
с координатами $(x, y)$ на квадрате, и обратное отображение строится аналогично
(\inlref{листинг}{lst:torus-s1s1}).

~~~~{label=lst:torus float=ht caption="Определение тора"}
data Torus = point | loop1 I | loop2 I | surf I I
  with
    loop1 left  = point
    loop1 right = point
    loop2 left  = point
    loop2 right = point
    surf i left  = loop1 i
    surf i right = loop1 i
    surf left  j = loop2 j
    surf right j = loop2 j
~~~~

~~~~{label=lst:s1s1 float=ht caption="Определение \lstinline{S1} и \lstinline{S1×S1}"}
data S1 = base | loop I
  with
    loop left  = base
    loop right = base

data S1xS1 = pair S1 S1
~~~~

~~~~{label=lst:torus-s1s1 float=ht caption="Эквивалентность тора и произведения окружностей"}
f : S1xS1 -> Torus
f (pair base base) = point
f (pair (loop i) base) = loop1 i
f (pair base (loop j)) = loop2 j
f (pair (loop i) (loop j)) = surf i j

g : Torus -> S1xS1
g point = pair base base
g (loop1 i) = pair (loop i) base
g (loop2 j) = pair base (loop j)
g (surf i j) = pair (loop i) (loop j)
~~~~

Остается только показать, что обе композиции этих отображений гомотопны тождественному
отображению, но доказательство этого факта тривиально, так как построенные
отображения попросту взаимно-обратны вычислительно.

Таким образом, теория типов с интервалом и условиями в некоторых случаях оказывается
удобнее стандартной теории с высшими индуктивными типами. Поскольку, как мы видели,
любой высший индуктивный тип может быть определен в теории с интервалом и условиями,
эта теория «не слабее» стандартной. Существуют ли типы, которые можно определить
в новой теории, но нельзя в старой, на данный момент неизвестно.
